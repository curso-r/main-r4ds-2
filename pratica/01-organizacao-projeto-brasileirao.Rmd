
Motivação: fazer análises sobre os resultados dos jogos do Brasileirão.

Passo 1: criar um projeto.

```{r}
usethis::create_project("analiseBrasileirao")
```

Passo 2: configurar o GIT

```{r}
usethis::use_git()
```

Passo 3: configurar o GitHub

```{r}
usethis::use_github()
```

Passo 4: pegar os dados e organizar as pastas data-raw e data

Os dados foram retirados do [repositório do pacote brasileirao](https://github.com/curso-r/main-r4ds-2) no GitHub.

Para saber mais sobre Web Scraping, vejam a nossa trilha de Web Scraping: https://curso-r.com/trilhas/ws/

```{r}
download.file("https://raw.githubusercontent.com/williamorim/brasileirao/master/data-raw/csv/matches.csv", destfile = "data-raw/brasileirao.csv")

brasileirao <- readr::read_csv("data-raw/brasileirao.csv")
```


Passo 5: Fazer gráfico do número de vitórias dos mandantes por ano.

```{r}
library(dplyr)
library(ggplot2)

tab_resul_mandante <- brasileirao %>% 
  filter(season <= 2020) %>% 
  tidyr::separate(
    score, 
    c("home_score", "away_score"), 
    sep = "x", 
    convert = TRUE
  ) %>% 
  mutate(
    home_win = home_score > away_score,
    result = case_when(
      home_score > away_score ~ "Vitória do mandante",
      home_score == away_score ~ "Empate",
      home_score < away_score ~ "Derrota do mandante"
    ),
    pontos = case_when(
      home_score > away_score ~ 3,
      home_score == away_score ~ 1,
      home_score < away_score ~ 0
    ),
    torcida = ifelse(season == 2020, "sem_torcida", "com_torcida")
  ) 

tab_grafico <- tab_resul_mandante %>% 
  count(season, torcida, result) %>% 
  group_by(season, torcida) %>% 
  mutate(prop = n/sum(n)) %>% 
  ungroup() 

tab_grafico %>% 
  ggplot(aes(x = season, y = prop, fill = result)) +
  geom_col(position = "stack") +
  geom_hline(yintercept = .5, linetype = 2, colour = 2, size = 1) +
  geom_label(
    aes(label = scales::percent(prop, accuracy = 1), y = prop / 2),
    size = 3,
    color = "white",
    data = filter(tab_grafico, result == "Vitória do mandante")
  ) +
  theme_minimal(14) +
  theme(
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    legend.text = element_text(size = 10)
  ) +
  scale_fill_viridis_d(begin = .8, end = .2) +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Desempenho dos mandantes",
    subtitle = "por temporada",
    x = "Temporada",
    y = "Proporção",
    fill = ""
  )
```


Passo 6: criar pasta docs e criar um Rmd

Passo 7: colocar o gráfico no relatório

Passo 8: fazendo um push para o Github

- Fazer um commit nas mudanças que fizemos.
- Fazer um push dos arquivos para o Github.
